{{ $item := .item }}

{{ $link := $item.RelPermalink }}
{{ $target := "" }}
{{ if $item.Params.external_link }}
  {{ $link = $item.Params.external_link }}
  {{ $target = "target=\"_blank\" rel=\"noopener\"" }}
{{ end }}

{{ $resource := partial "functions/get_featured_image.html" $item }}
{{ $anchor := "Center" }}
{{ if and $item.Params.image (reflect.IsMap $item.Params.image) }}
  {{ $anchor = $item.Params.image.focal_point | default "Center" }}
{{ end }}
{{ $fill_image := .config.fill_image | default true }}
{{ $index := .index }}

<div class="group bg-white/90 dark:bg-zinc-900/90 backdrop-blur-sm rounded-2xl ring-1 ring-zinc-900/5 dark:ring-white/10 shadow-lg overflow-hidden transition-all duration-300 ease-out hover:shadow-xl hover:shadow-primary-500/10 hover:-translate-y-2 focus-within:ring-2 focus-within:ring-primary-500/50" role="article" aria-labelledby="card-title-{{ $item.File.UniqueID }}">
  <div class="relative overflow-hidden aspect-[16/9] bg-gradient-to-br from-zinc-100 to-zinc-200 dark:from-zinc-800 dark:to-zinc-900">
    {{ with $resource }}
      {{ if strings.Contains .MediaType.SubType "svg" }}
        <a href="{{ $link }}" {{ $target | safeHTMLAttr }} class="block">
          <img class="w-full h-full transition-transform duration-500 ease-out group-hover:scale-105 {{ if $fill_image }}object-fill{{ else }}object-contain{{ end }}"
               src="{{ .RelPermalink }}"
               loading="lazy"
               decoding="async"
               {{ if eq $index 0 }}fetchpriority="high"{{ end }}
               style="position: absolute; height: 100%; width: 100%; inset: 0px; color: transparent;"
               alt="{{ $item.Title | plainify }} featured image">
        </a>
      {{ else if ne .MediaType.SubType "gif" }}
        {{ $original_image := "" }}
        {{ if $fill_image }}
          {{ $original_image = .Fill (printf "800x450 %s" $anchor) }}
        {{ else }}
          {{ $original_image = .Fit (printf "800x450 %s" $anchor) }}
        {{ end }}
        {{ $responsive := partial "functions/process_responsive_image.html" (dict
            "image" $original_image
            "mode" "responsive"
            "sizes" (slice 400 600 800)
            "formats" (slice "avif" "webp" "jpg")
        ) }}
        <a href="{{ $link }}" {{ $target | safeHTMLAttr }} class="block">
          <img class="w-full h-full transition-transform duration-500 ease-out group-hover:scale-105 {{ if $fill_image }}object-fill{{ else }}object-contain{{ end }}"
               srcset="{{ $responsive.srcset }}"
               sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"
               src="{{ $responsive.fallback.RelPermalink }}"
               width="{{ $original_image.Width }}"
               height="{{ $original_image.Height }}"
               loading="lazy"
               decoding="async"
               {{ if eq $index 0 }}fetchpriority="high"{{ end }}
               style="position: absolute; height: 100%; width: 100%; inset: 0px; color: transparent;"
               alt="{{ $item.Title | plainify }} featured image">
        </a>
      {{ else }}
        <a href="{{ $link }}" {{ $target | safeHTMLAttr }} class="block">
          <img class="w-full h-full transition-transform duration-500 ease-out group-hover:scale-105 {{ if $fill_image }}object-fill{{ else }}object-contain{{ end }}"
               src="{{ .RelPermalink }}"
               width="{{ .Width }}"
               height="{{ .Height }}"
               loading="lazy"
               decoding="async"
               style="position: absolute; height: 100%; width: 100%; inset: 0px; color: transparent;"
               alt="{{ $item.Title | plainify }} featured image">
        </a>
      {{ end }}
    {{ else }}
      <a href="{{ $link }}" {{ $target | safeHTMLAttr }} class="block w-full h-full">
        <div class="w-full h-full bg-gradient-to-br from-primary-600/40 via-secondary-600/30 to-primary-800/50 flex items-center justify-center transition-all duration-300 group-hover:from-primary-500/50 group-hover:via-secondary-500/40 group-hover:to-primary-700/60">
          <div class="w-16 h-16 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center group-hover:scale-110 transition-transform duration-300">
            <svg class="w-8 h-8 text-white/40" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd"/>
            </svg>
          </div>
        </div>
      </a>
    {{ end }}

    <div class="absolute inset-0 pointer-events-none bg-gradient-to-t from-black/10 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
  </div>

  <div class="p-6">
    <h3 id="card-title-{{ $item.File.UniqueID }}" class="text-lg font-bold tracking-tight text-zinc-900 dark:text-zinc-100 group-hover:text-primary-600 dark:group-hover:text-primary-400 transition-colors duration-200 leading-tight">
      <a href="{{ $link }}" {{ $target | safeHTMLAttr }} class="hover:underline">
        {{ $item.Title }}
        {{ if $item.Params.external_link }}
          {{ partial "functions/get_icon" (dict "name" "arrow-top-right-on-square" "attributes" "style=\"height: 1em;\" class=\"inline-flex h-4 w-4 ml-1 align-text-top\"") }}
        {{ end }}
      </a>
    </h3>
  </div>
</div>
